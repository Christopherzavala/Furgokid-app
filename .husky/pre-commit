#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Validando configuraci√≥n de Expo antes del commit..."

# Validar que app.config.js no tenga errores de sintaxis
npx expo config --type public > /dev/null 2>&1

if [ $? -ne 0 ]; then
  echo "‚ùå ERROR: app.config.js tiene errores de sintaxis"
  echo "Ejecuta: npx expo config --type public para ver detalles"
  exit 1
fi

echo "‚úÖ app.config.js v√°lido"

# Validar que no se est√©n commiteando secrets
echo "üîê Verificando que no se commiteen secrets..."

if git diff --cached --name-only | grep -q "^\.env$"; then
  echo "‚ùå ERROR: Intentando commitear .env"
  echo "Los secrets NO deben ir a Git. Usa EAS Secrets para producci√≥n."
  exit 1
fi

# Verificar que no haya API keys hardcodeadas
if git diff --cached -U0 | grep -E "(AIza[0-9A-Za-z-_]{35}|AAAA[0-9A-Za-z-_:]{100,}|ca-app-pub-[0-9]{16})"; then
  echo "‚ö†Ô∏è  WARNING: Se detectaron posibles API keys en el c√≥digo"
  echo "Verifica que no est√©s hardcodeando secrets"
  read -p "¬øContinuar de todos modos? (y/N): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
fi

echo "‚úÖ Validaci√≥n de seguridad completada"
exit 0
